// prisma/schema.prisma

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id              Int      @id @default(autoincrement())
  googleUserId    String?  @unique @map("google_user_id") 
  email           String?  @unique
  name            String?
  givenName       String?  @map("given_name")
  familyName      String?  @map("family_name")
  picture         String?
  credits         String   @default("5")  // 初始积分
  accessToken     String?  @db.Text @map("access_token")
  ip              String?  @default("0.0.0.0")
  type            String   @default("1") // 网站类型标识
  lastDailyReward DateTime? @map("last_daily_reward") // 最后签到时间
  currentStreak   Int?     @default(0) @map("current_streak") // 连续签到天数
  createTime      DateTime @default(now()) @map("create_time")
  updateTime      DateTime @updatedAt @map("update_time")

  // 交易记录
  transactions    Transaction[]

  @@map("users")
}

// 积分交易记录表
model Transaction {
  id          Int      @id @default(autoincrement())
  userId      Int
  user        User     @relation(fields: [userId], references: [id])
  type        String   // "deduct" | "add" | "purchase" | "daily_reward"
  amount      Int      // 积分数量
  description String?  // 交易描述
  metadata    Json?    // 额外信息 (如订单ID等)
  createdAt   DateTime @default(now()) @map("created_at")

  @@map("transactions")
}